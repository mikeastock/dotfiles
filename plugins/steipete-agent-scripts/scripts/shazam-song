#!/usr/bin/env -S uv run --quiet --script
# /// script
# requires-python = ">=3.12,<3.13"
# dependencies = ["shazamio"]
# ///
"""
shazam-song - Identify songs from audio files using Shazam API
Usage: shazam-song <audio-file>
"""

import asyncio
import sys
from shazamio import Shazam


async def main():
    if len(sys.argv) < 2:
        print("Usage: shazam-song <audio-file>", file=sys.stderr)
        sys.exit(1)

    shazam = Shazam()
    out = await shazam.recognize(sys.argv[1])
    if out.get("track"):
        track = out["track"]
        title = track.get("title", "Unknown")
        artist = track.get("subtitle", "Unknown")
        print(f"üéµ {title} - {artist}")

        # Print extra info if available
        if track.get("genres"):
            genres = track["genres"].get("primary", "")
            if genres:
                print(f"   Genre: {genres}")
        if track.get("url"):
            print(f"   Shazam: {track['url']}")
    else:
        print("‚ùå Song not recognized")
        sys.exit(1)


if __name__ == "__main__":
    asyncio.run(main())
